# vim:ts=2:sw=2:sts=2:et:ai:fdm=marker:tw=100

- hosts: cassandra
  user: root
  tasks:
  - name: Add zabbix check script
    copy:
      src: zabbix_linux_distro_check.pl
      dest: /usr/local/bin/zabbix_linux_distro_check.pl
      backup: no
      owner: root
      group: root
      mode: 0755
  - name: Configure Zabbix agent
    lineinfile:
      dest: /etc/zabbix/zabbix_agentd.conf
      line: 'UserParameter=custom.package_system,/usr/local/bin/zabbix_linux_distro_check.pl'
      state: present
  - name: Restart zabbix-agent
    service:
      name: zabbix-agent
      state: restarted
